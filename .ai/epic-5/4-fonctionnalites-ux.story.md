# Epic-5: Internationalisation et Multilinguisme

Story-4: FonctionnalitÃ©s d'internationalisation et expÃ©rience utilisateur

## Description de la Story

**En tant qu'** utilisateur du CV Generator
**Je veux** pouvoir changer la langue de l'interface et avoir une dÃ©tection automatique de ma langue prÃ©fÃ©rÃ©e
**afin de** utiliser l'application dans ma langue maternelle et bÃ©nÃ©ficier d'une meilleure expÃ©rience utilisateur

## Statut

En cours

## Contexte

Cette story fait partie de l'Epic-5 qui vise Ã  internationaliser notre application CV Generator. Elle s'appuie sur les Stories 1, 2 et 3 qui ont Ã©tabli l'architecture d'internationalisation, centralisÃ© les clÃ©s de traduction et adaptÃ© les composants existants.

Maintenant que l'infrastructure technique d'internationalisation est en place, cette story se concentre sur les aspects d'expÃ©rience utilisateur liÃ©s au changement de langue. Elle vise Ã  crÃ©er une interface intuitive permettant Ã  l'utilisateur de sÃ©lectionner sa langue prÃ©fÃ©rÃ©e, avec une dÃ©tection automatique basÃ©e sur la langue du navigateur et une persistance de ce choix.

Cette story est cruciale pour rendre l'internationalisation visible et utile pour l'utilisateur final, et pour assurer une expÃ©rience cohÃ©rente Ã  travers toute l'application.

## Estimation

Story Points: 2

## CritÃ¨res d'Acceptation

1. âœ… Ã‰tant donnÃ© un utilisateur qui ouvre l'application pour la premiÃ¨re fois, quand l'application se charge, alors la langue dÃ©tectÃ©e du navigateur est automatiquement utilisÃ©e si elle est supportÃ©e
2. âœ… Ã‰tant donnÃ© un utilisateur qui souhaite changer de langue, quand il clique sur le sÃ©lecteur de langue, alors il peut choisir parmi les langues disponibles (franÃ§ais, anglais)
3. âœ… Ã‰tant donnÃ© qu'un utilisateur a choisi une langue, quand il revient sur l'application ultÃ©rieurement, alors sa prÃ©fÃ©rence est conservÃ©e
4. âœ… Ã‰tant donnÃ© un utilisateur qui change de langue, quand la langue est modifiÃ©e, alors tous les textes de l'interface sont immÃ©diatement mis Ã  jour dans la nouvelle langue
5. âœ… Ã‰tant donnÃ© un sÃ©lecteur de langue, quand il est visible dans l'interface, alors il indique clairement la langue actuellement sÃ©lectionnÃ©e
6. âœ… Ã‰tant donnÃ© la nature responsive de l'application, quand le sÃ©lecteur de langue est implÃ©mentÃ©, alors il est utilisable sur tous les formats d'Ã©cran supportÃ©s

## TÃ¢ches

1. - [x] ImplÃ©menter la dÃ©tection de langue du navigateur

   1. - [x] CrÃ©er une fonction d'initialisation qui dÃ©tecte la langue du navigateur
   2. - [x] Mettre en place la logique de fallback vers la langue par dÃ©faut (franÃ§ais)
   3. - [x] IntÃ©grer cette dÃ©tection au dÃ©marrage de l'application

2. - [x] CrÃ©er le composant de sÃ©lection de langue

   1. - [x] Concevoir le sÃ©lecteur de langue avec une UI accessible
   2. - [x] ImplÃ©menter la logique de changement de langue
   3. - [x] Ajouter des icÃ´nes ou drapeaux pour les langues disponibles
   4. - [x] Tester l'accessibilitÃ© du composant (navigation clavier, etc.)

3. - [x] ImplÃ©menter la persistance des prÃ©fÃ©rences linguistiques

   1. - [x] Stocker la prÃ©fÃ©rence de langue dans localStorage
   2. - [x] CrÃ©er une logique de rÃ©cupÃ©ration au dÃ©marrage de l'application
   3. - [x] GÃ©rer la synchronisation entre locales et prÃ©fÃ©rences stockÃ©es

4. - [x] Ajouter le sÃ©lecteur de langue dans l'interface

   1. - [x] IntÃ©grer le sÃ©lecteur dans l'en-tÃªte de l'application
   2. - [x] Assurer sa visibilitÃ© sur tous les Ã©crans de l'application
   3. - [x] Adapter le design pour les diffÃ©rentes tailles d'Ã©cran

5. - [x] Optimiser le chargement des traductions
   1. - [x] ImplÃ©menter un mÃ©canisme robuste de chargement des fichiers de traduction
   2. - [x] Ajouter une gestion d'erreurs pour Ã©viter les Ã©crans blancs
   3. - [x] PrÃ©charger les traductions par dÃ©faut pour garantir un fonctionnement minimal

## Avancement

### 2024-05-13 - ImplÃ©mentation des fonctionnalitÃ©s de base

Nous avons implÃ©mentÃ© avec succÃ¨s les fonctionnalitÃ©s suivantes :

1. **DÃ©tection de langue du navigateur** :

   - CrÃ©ation d'une fonction `detectBrowserLanguage()` qui dÃ©tecte la langue prÃ©fÃ©rÃ©e de l'utilisateur parmi les langues supportÃ©es
   - Mise en place d'un fallback vers la langue par dÃ©faut (franÃ§ais) lorsque la langue du navigateur n'est pas supportÃ©e
   - IntÃ©gration de cette dÃ©tection au dÃ©marrage de l'application via la fonction `getInitialLocale()`

2. **Composant de sÃ©lection de langue** :

   - CrÃ©ation d'un composant `LanguageSelector` accessible avec support clavier
   - Ajout des drapeaux pour chaque langue (ðŸ‡«ðŸ‡·, ðŸ‡¬ðŸ‡§)
   - Mise en Å“uvre d'une UI responsive s'adaptant aux diffÃ©rentes tailles d'Ã©cran
   - Tests des fonctionnalitÃ©s et de l'accessibilitÃ©

3. **Persistance des prÃ©fÃ©rences linguistiques** :

   - Stockage de la langue sÃ©lectionnÃ©e dans localStorage
   - RÃ©cupÃ©ration automatique de la prÃ©fÃ©rence de l'utilisateur au dÃ©marrage
   - Gestion des cas d'erreur d'accÃ¨s au localStorage

4. **IntÃ©gration dans l'interface** :
   - Ajout du composant `LanguageSelector` dans l'en-tÃªte de l'application
   - Mise en place d'un positionnement adaptatif selon la taille de l'Ã©cran

### 2024-05-14 - Optimisation et robustesse

AprÃ¨s avoir rencontrÃ© des problÃ¨mes d'Ã©cran blanc lors du chargement de l'application, nous avons implÃ©mentÃ© plusieurs amÃ©liorations :

1. **Optimisation du chargement des traductions** :

   - PrÃ©chargement des messages par dÃ©faut pour assurer un fonctionnement minimal de l'application
   - Mise en place d'une architecture de chargement progressive des traductions
   - Ajout de journalisation dÃ©taillÃ©e pour faciliter le dÃ©bogage

2. **Gestion des erreurs robuste** :

   - Restructuration de la logique d'initialisation de l'application pour Ã©viter les Ã©crans blancs
   - Mise en place de mÃ©canismes de fallback pour gÃ©rer les Ã©checs de chargement des traductions
   - Montage de l'application mÃªme en cas d'erreur pour garantir une expÃ©rience utilisateur minimale

3. **Architecture asynchrone amÃ©liorÃ©e** :
   - Refactorisation du code pour utiliser async/await de maniÃ¨re plus robuste
   - Simplification des promesses chaÃ®nÃ©es pour Ã©viter les problÃ¨mes de double montage de l'application
   - Centralisation des erreurs et amÃ©lioration des messages de journalisation

Toutes les exigences d'UX et fonctionnelles pour cette story sont maintenant satisfaites. L'application dÃ©tecte correctement la langue de l'utilisateur, permet de changer facilement de langue via l'interface, et persiste ce choix entre les sessions.

## Principes de DÃ©veloppement

#### Principes Ã  Suivre

- **UX First**: Concevoir en priorisant l'expÃ©rience utilisateur et l'intuitivitÃ©
- **AccessibilitÃ©**: Respecter les standards WCAG AA pour le sÃ©lecteur de langue
- **Performance**: Assurer que le changement de langue est immÃ©diat et fluide
- **Persistance**: Garantir la conservation des prÃ©fÃ©rences utilisateur
- **Feedback visuel**: Fournir un retour clair lors du changement de langue

#### Ã€ Ã‰viter

- Une interface de sÃ©lection de langue trop complexe ou peu intuitive
- Des incohÃ©rences visuelles lors du changement de langue
- Des performances dÃ©gradÃ©es lors du chargement des fichiers de traduction
- Une dÃ©tection de langue qui override la prÃ©fÃ©rence explicite de l'utilisateur
- Un sÃ©lecteur de langue difficile Ã  trouver dans l'interface

## Risques et HypothÃ¨ses

| Risque                                                     | ProbabilitÃ© | Impact | Mitigation                                                                       |
| ---------------------------------------------------------- | ----------- | ------ | -------------------------------------------------------------------------------- |
| Performance dÃ©gradÃ©e lors du changement de langue          | Moyenne     | Ã‰levÃ©  | ImplÃ©menter un chargement optimisÃ© des fichiers de traduction                    |
| IncohÃ©rences visuelles avec textes de longueurs variables  | Ã‰levÃ©e      | Moyen  | Concevoir une interface flexible qui s'adapte aux diffÃ©rentes longueurs de texte |
| ProblÃ¨mes avec la dÃ©tection de langue du navigateur        | Moyenne     | Faible | Avoir un fallback robuste vers la langue par dÃ©faut                              |
| Conflit entre localStorage et prÃ©fÃ©rences de l'utilisateur | Faible      | Moyen  | Prioriser clairement les prÃ©fÃ©rences explicites de l'utilisateur                 |
| AccessibilitÃ© rÃ©duite pour certains utilisateurs           | Moyenne     | Ã‰levÃ©  | Tester rigoureusement l'accessibilitÃ© du sÃ©lecteur de langue                     |

## Notes de DÃ©veloppement

### Architecture de chargement des traductions

Pour amÃ©liorer la robustesse du chargement des traductions, nous avons implÃ©mentÃ© une architecture en plusieurs Ã©tapes :

1. **PrÃ©chargement des messages par dÃ©faut** :

```typescript
export async function preloadDefaultMessages() {
  if (defaultMessagesLoaded) return;

  try {
    console.log(`Preloading default messages for ${DEFAULT_LOCALE}`);
    const defaultMessages = await import(`./locales/${DEFAULT_LOCALE}.json`);
    i18n.global.setLocaleMessage(DEFAULT_LOCALE, defaultMessages.default);
    defaultMessagesLoaded = true;
    console.log("Default messages preloaded successfully");
  } catch (error) {
    console.error(
      `Failed to preload default messages for ${DEFAULT_LOCALE}:`,
      error
    );
    // DÃ©finir un objet de messages minimal pour Ã©viter les erreurs
    i18n.global.setLocaleMessage(DEFAULT_LOCALE, {
      common: {
        errors: {
          generic: "Une erreur s'est produite",
        },
        actions: {
          save: "Enregistrer",
          cancel: "Annuler",
        },
      },
    });
  }
}
```

2. **Initialisation sÃ©curisÃ©e de l'application** :

```typescript
const initializeApp = async () => {
  console.log("Initializing application...");

  try {
    // 1. PrÃ©charger les messages par dÃ©faut (pour garantir une fallback)
    await preloadDefaultMessages();

    // 2. DÃ©tecter la langue et charger les messages correspondants
    const detectedLocale = getInitialLocale();
    console.log(`Detected locale: ${detectedLocale}`);

    if (detectedLocale !== DEFAULT_LOCALE) {
      try {
        await loadLocaleMessages(detectedLocale);
        console.log(`Successfully loaded messages for ${detectedLocale}`);
      } catch (error) {
        console.error(
          `Failed to load messages for ${detectedLocale}, using default locale`,
          error
        );
        // Pas besoin de charger Ã  nouveau les messages par dÃ©faut car ils ont Ã©tÃ© prÃ©chargÃ©s
      }
    }

    // 3. Monter l'application
    console.log("Mounting application...");
    app.mount("#app");
    console.log("Application mounted successfully");
  } catch (error) {
    console.error("Critical error during app initialization:", error);

    // En cas d'erreur critique, monter quand mÃªme l'application
    // pour permettre Ã  l'utilisateur d'interagir avec l'interface
    console.warn("Mounting application despite initialization errors");
    app.mount("#app");
  }
};
```

### Composant de sÃ©lection de langue

Le composant LanguageSelector a Ã©tÃ© implÃ©mentÃ© avec une UI accessible et une expÃ©rience utilisateur intuitive. Il affiche les langues disponibles avec leur drapeau et leur nom dans la langue correspondante. Le composant est conÃ§u pour Ãªtre responsive et s'adapter aux diffÃ©rentes tailles d'Ã©cran:

- Sur les Ã©crans larges, il affiche un menu dÃ©roulant classique
- Sur les Ã©crans mobiles, il affiche un menu en bas de l'Ã©cran, plus facile Ã  utiliser sur tactile

```css
/* Responsive */
@media (max-width: 640px) {
  .language-selector__dropdown {
    position: fixed;
    top: auto;
    bottom: 0;
    left: 0;
    right: 0;
    width: 100%;
    border-radius: 0.5rem 0.5rem 0 0;
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
    padding: 0.5rem 0;
  }

  .language-selector__item {
    padding: 0.75rem 1rem;
    justify-content: center;
  }
}
```

## Journal de Communication

- UX Designer: Le sÃ©lecteur de langue doit Ãªtre accessible depuis toutes les pages de l'application
- Dev: OÃ¹ placer le sÃ©lecteur de langue dans l'interface?
- UX Designer: Dans l'en-tÃªte, cÃ´tÃ© droit, avec une indication visuelle claire
- Dev: Faut-il utiliser des drapeaux pour reprÃ©senter les langues?
- UX Designer: Oui, les drapeaux combinÃ©s avec les noms dans leur propre langue (FranÃ§ais, English) pour plus de clartÃ©
- Dev: Comment gÃ©rer le cas oÃ¹ la langue dÃ©tectÃ©e n'est pas supportÃ©e?
- Tech Lead: Avoir un fallback sur la langue par dÃ©faut (franÃ§ais) et permettre Ã  l'utilisateur de changer facilement
- Dev: Quel comportement adopter si l'utilisateur change de langue en plein formulaire?
- UX Designer: Tous les textes doivent Ãªtre mis Ã  jour immÃ©diatement, mais les donnÃ©es saisies doivent Ãªtre prÃ©servÃ©es
- Dev: Faut-il un message de confirmation lors du changement de langue?
- UX Designer: Non, le changement doit Ãªtre immÃ©diat avec un feedback visuel clair (le nom de la langue actuelle)
- Dev: Comment Ã©viter les Ã©crans blancs lors du chargement des traductions?
- Tech Lead: ImplÃ©menter un mÃ©canisme de prÃ©chargement des traductions par dÃ©faut et monter l'application mÃªme en cas d'erreur
